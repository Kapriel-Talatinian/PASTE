@echo off
title Bot Telegram Trading
chcp 65001 >nul
echo VÃ©rification de l'installation de Python...

:: VÃ©rifier si Python est installÃ©
where python >nul 2>&1
if %errorlevel% neq 0 (
    echo Python n'est pas installÃ©. Installation automatique en cours...
    powershell -Command "& {[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12; Invoke-WebRequest -Uri 'https://www.python.org/ftp/python/3.11.0/python-3.11.0-amd64.exe' -OutFile 'python_installer.exe'}"
    start /wait python_installer.exe /quiet InstallAllUsers=1 PrependPath=1
    del python_installer.exe
    echo Python a Ã©tÃ© installÃ© avec succÃ¨s.

    :: Ajouter Python au PATH immÃ©diatement
    setx PATH "%PATH%;C:\Python311;C:\Python311\Scripts" /M
    set "PATH=%PATH%;C:\Python311;C:\Python311\Scripts"
)

:: VÃ©rifier si pip est installÃ©
python -m ensurepip --default-pip >nul 2>&1
python -m pip install --upgrade pip >nul 2>&1

:: Installer les dÃ©pendances Python
echo Installation des dÃ©pendances...
python -m pip install yfinance pandas numpy ta pyTelegramBotAPI >nul 2>&1

:: CrÃ©ation du script Python
echo import os > trading_bot.py
echo import yfinance as yf >> trading_bot.py
echo import telebot >> trading_bot.py
echo import pandas as pd >> trading_bot.py
echo import numpy as np >> trading_bot.py
echo from ta.trend import ADXIndicator, MACD >> trading_bot.py
echo from ta.momentum import StochasticOscillator >> trading_bot.py
echo import time >> trading_bot.py

:: Configuration du bot Telegram
echo TELEGRAM_BOT_TOKEN = '7343754821:AAFxzk453jSeqQhz2IqxFKfOTV9_txYwKls' >> trading_bot.py
echo CHAT_ID = '-4508141227' >> trading_bot.py
echo bot = telebot.TeleBot(TELEGRAM_BOT_TOKEN) >> trading_bot.py

:: Actifs surveillÃ©s
echo SYMBOLS = {'XAU/USD': 'GC=F', 'NDX/USD': '^NDX'} >> trading_bot.py
echo TIMEFRAME = '1h' >> trading_bot.py

:: Fonction principale avec boucle infinie
echo def main(): >> trading_bot.py
echo.    while True: >> trading_bot.py
echo.        for symbol in SYMBOLS.keys(): >> trading_bot.py
echo.            df = get_data(symbol) >> trading_bot.py
echo.            df = calculate_indicators(df) >> trading_bot.py
echo.            if not df.empty: >> trading_bot.py
echo.                signal = check_signals(df) >> trading_bot.py
echo.                if signal: >> trading_bot.py
echo.                    message = f'ðŸ“¢ Signal {signal} dÃ©tectÃ© sur {symbol} ({TIMEFRAME})\nâš¡ 2 indicateurs alignÃ©s + ADXR confirmÃ©' >> trading_bot.py
echo.                    bot.send_message(CHAT_ID, message) >> trading_bot.py
echo.        time.sleep(60) >> trading_bot.py

:: ExÃ©cution du bot
echo if __name__ == '__main__': >> trading_bot.py
echo.    main() >> trading_bot.py

:: Lancer le script Python
echo Lancement du bot...
python trading_bot.py

pause
